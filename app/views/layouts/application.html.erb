<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
		xmlns:og="http://opengraphprotocol.org/schema/"
      xmlns:fb="http://www.facebook.com/2008/fbml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title><%=  t(:popup)%></title>
    
    <!-- Script TACTfactory -->
    <%= javascript_include_tag "jquery.min" %>
    <%= javascript_include_tag "jquery-ui.min" %>
    <%= javascript_include_tag "jquery.hint" %>
    <%= javascript_include_tag "jquery.jcarousel.min" %>
    <%= javascript_include_tag "jquery.chosen.min" %>
    <%= javascript_include_tag "jquery.fileinput" %>
    
    <!-- Script Old -->
    <%= javascript_include_tag "application" %>
    <%= javascript_include_tag "geoRssOverlay" %>
    <%= javascript_include_tag "markerGroup" %>
    <%= javascript_include_tag "ym4r-gm" %>
	 <%#= javascript_include_tag "https://js.stripe.com/v1/" %>
    <%= javascript_include_tag "tmpl" %>
    <%= javascript_include_tag "easing" %>
    <%= javascript_include_tag "elastislide" %>
    <%= javascript_include_tag "gallery" %>
    
    <!-- CSS TACTfactory -->    
    <%= stylesheet_link_tag "jquery-ui" %>
    <%= stylesheet_link_tag "jquery.chosen" %> 
    <%= stylesheet_link_tag "application" %> 
    

	 <!-- CSS Old -->
    <link rel="stylesheet" type="text/css" href="http://static.jquery.com/ui/css/demo-docs-theme/ui.theme.css"/> <!-- jsFiddle --> 
   
    <script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;&amp;v=2&amp;key=AIzaSyAPEeqlhndG4KU6-bRWegIBrs-v-kFcdgY" ></script>
    <script type="text/javascript" src="http://www.facebook.com/assets.php/en_US/all.js" ></script>
    <script type="text/javascript" src="https://www.paypalobjects.com/js/external/dg.js"></script>

    <%= GMap.header(:with_vml => false, :host => request.host).html_safe %>
    <%= raw(@map.to_html) if @map %>
    <%= csrf_meta_tags %>
    <%= javascript_include_tag "dg" %>
    <%= yield(:head) %>

    <noscript>    
      <style>
        .es-carousel ul{
          display:block;
        }
      </style>
    </noscript>
    
    <script id="img-wrapper-tmpl" type="text/x-jquery-tmpl">
      <div class="rg-image-wrapper">
        {{if itemsCount > 1}}
        <div class="rg-image-nav">
          <a href="#" class="rg-image-nav-prev"><%= t(:prev_image) %></a>
          <a href="#" class="rg-image-nav-next"><%= t(:next_image) %></a>
        </div>
        {{/if}}
        <div class="rg-image"></div>
        <div class="rg-loading"></div>
        <div class="rg-caption-wrapper">
          <div class="rg-caption" style="display:none;">
            <p></p>
          </div>
        </div>
      </div>
    </script> 
  </head>

  <body>
    <div class="maincontainer">
      <div class="header">
      	<div class="header-background"></div>
			<div class="maincontainer">
          <div class="logo">
            <%= link_to image_tag("Objet-dynamique-vectoriel.png"), root_path %>
          </div>

          <div class="menubar">
            <div class="dropdowns">
              <div class="dropdown">
                <span><%= params[:locale]== 'fr' ? 'FR' : 'EN' %></span>
                <ul>
                  <li><%= link_to "FR", "#", :onclick => "addParamToUrl('locale', 'fr')" %></li>
                  <li><%= link_to "EN", "#", :onclick => "addParamToUrl('locale', 'en')" %></li>
                </ul>
              </div>
              <div class="dropdown">
                <span> <%= session[:curr]== 'USD' ? '$' : '€' %> </span>
                <ul>
                  <li><%= link_to "$", "#", :onclick => "addParamToUrl('curr', 'USD')" %></li>
                  <li><%= link_to "€", "#", :onclick => "addParamToUrl('curr', 'EUR')" %></li>
                </ul>
              </div>
				<br/><%= link_to(image_tag("listaspace.png"), new_item_path, :style=>"display: block; margin-top: 10px;" ) %>
					<%#*<img class="listaspace" src="../assets/" />%>
            </div>
                    
            <% if user_signed_in? %>
              <span id="bar-navigate" class="menubar-left">
                <% unread_notifications_count = current_user.notifications.unread_notifications.count %>
                <%= link_to t(:dashboard), inbox_messages_path, :class => ((params[:controller] == "accounts" or params[:controller] == "messages" or params[:controller] == "users" or params[:controller] == "email_settings"  or (params[:controller] == "items" and params[:action] != "show" and params[:action] !="search_keyword") ) ? "m_act" : ""), :style => "float: left; padding-bottom: 5px;" %>
                <% messages_size = current_user.messages.are_to(current_user).unread.size %>
                <% if messages_size > 0 %>
                  <%= link_to "("+ messages_size.to_s+")", inbox_messages_path, :style=>["padding-left: 2px;text-align: left !important;"] %>
                <% end %>

                <div style="float:left;" class='<%= (((params[:controller] == "items" and params[:action] == "search_keyword")  or params[:controller] == "searches" or (params[:controller] == "items" and params[:action] == "show")) ? "m_act" : "") %>'>
                  <div class="searchDropdown searchMenu" onclick="search_menu()">
                    <span class="searchMenu" >
                      <%= 'Search' %> 
                      <ul id="search_options" class="searchMenu">
                        <li class="searchMenu"><%= link_to t(:spaces3), "/searches/spaces" %></li>
                        <li class="searchMenu"><%= link_to t(:gatherings2),  "/searches/gatherings" %></li>
                        <li class="searchMenu"><%= link_to "Members",  "/searches/members" %></li>
                      </ul>
                    </span>
                  </div>
                  <%= link_to "Hi #{current_user.popup_storz_display_name}", dashboard_path(current_user.id),:class => ((params[:controller] == "home" and params[:action] == "index") or (params[:controller] == "users" and params[:action] == "show") ? "m_act" : "") %>
	              <% messages_size = current_user.messages.are_to(current_user).unread.size %>
	              <% if messages_size > 0 %>
	                <%= link_to "("+ messages_size.to_s+")", inbox_messages_path, :style=>["padding-left: 2px;text-align: left !important;"] %>
	              <% end %>
	              <%= link_to('Logout', destroy_user_session_path, :method => :delete) %>
                </div>
  					 <%#= link_to 'Search', search_home_searches_path, :class => ((params[:controller] == "searches") ? "m_act" : "") %>
              </span>
              <div divclass="clear"></div>
              
              <span id="bar-search" class="menubar-left" style="margin-left: 100px;">
                <% if params[:controller] == "searches" %>
    					<%#= link_to 'Members', members_searches_path, :class => ((params[:controller] == "searches" and ( params[:action] == "members" or params[:action] == "search_members" )) ? "m_act" : "") %>
    					<%#= link_to 'Gatherings', gatherings_searches_path, :class => ((params[:controller] == "searches" and ( params[:action] == "gatherings" or params[:action] == "search_gatherings" )) ? "m_act" : "") %>
                <% end %>
              </span>
              
            <% else %> <!-- Test : if unauthorized -->
              <span id="bar-unauth" class="menubar-left">
                <a href="/home/about" class="<%= (( params[:controller] == "home" && params[:action] == "about") ? "m_act" : "")%>">About</a>
                <%= link_to 'Signup', new_user_registration_path, :class=>((( params[:controller] == "registrations" || params[:controller] == "devise/passwords" )&& params[:action] == "new") ? "m_act" : "")  %>
                <a href="#" onclick="login_menu()">Login</a>
                <div class="clear"></div>
                <div id="loginpannel" class="loginpannel" style="margin-left: 179px;">
	            <% unless user_signed_in? %>
	              <%= form_tag new_user_session_path do %>
	                <%= text_field_tag 'user[email]' %>
	                <%= password_field_tag 'user[password]' %>
	                <input type="submit" value="Login" />
	                <%#= link_to "Forgot your password?", new_password_path(User) %><br />
	
	              <% end %>
	            <% else %>
	              
	            <% end %>
	          </div>
              </span>
              
            <% end %> <!-- End Test Authorized -->
          </div>
        </div>
      </div>

		<!-- Test B  TACT=This is a joke ??? -->
              <% if 
              		(params[:action] == "dashboard")  || 
              		(params[:controller] == "messages") ||		# TACT= allway true (params[:action] == "inbox" && params[:controller] == "messages") ||
              		(params[:controller] == "email_settings") ||
              		(params[:controller] == "users" && (
              				params[:action] == "show"	||
              				params[:action] == "invitations")
              		)  ||              		
              		(params[:controller] == "items" && (
	              			params[:action] == "listings_home"						||
	              			params[:action] == "new" 									|| 
	              			params[:action] == "my_pop_ups"							|| 
	              			params[:action] == "gatherings"							|| 
	              			params[:action] == "favorites"							|| 
	              			params[:action] == "overview"								|| 
	              			params[:action] == "index"									|| 
	              			params[:action] == "gatherings_at_my_place"			|| 
	              			params[:action] == "created_prev_gatherings"			|| 
	              			params[:action] == "created_coming_gatherings"		|| 
	              			params[:action] == "pending_gathering_acceptance"	|| 
	              			params[:action] == "past_transactions" )
              		) %>

                <div id="bar-useraction" class="menu-sub-layout" style="margin-top: 86px;">
                		<!-- Test C  TACT=This is a joke ??? why check Test B ?-->
	                  <% if (
	                  	params[:controller] == "accounts"	|| 
	                  	params[:controller] == "messages"	|| 
	                  	params[:controller] == "items"		|| 
	                  	params[:controller] == "users"		|| 
	                  	params[:controller] == "email_settings" 
	                  	) %>
	                  	<span class="menu-sub" style="background-color: <%= (params[:controller] == 'messages' ) ? 'cyan' : '' %>">
		                    <%= link_to 'Messages', inbox_messages_path %>
		                  </span>
		                  <span class="menu-sub" style="background-color: <%= (params[:controller] == 'items' ) ? 'cyan' : '' %>">
		                    <%= link_to 'My Listings', overview_items_path %>
		                  </span>
		                  <span class="menu-sub" style="background-color: <%= (params[:controller] == 'items' ) ? 'cyan' : '' %>">
		                    <%= link_to 'My Bookings', "/items/created_coming_gatherings"%>
		                  </span>
		                  <span class="menu-sub" style="background-color: <%= (params[:controller] == 'items' ) ? 'cyan' : '' %>">
		                    <%= link_to 'My Favorites', favorites_items_path %>
		                  </span>
		                  <span class="menu-sub" style="background-color: <%= (params[:controller] == 'users' ) ? 'cyan' : '' %>">
		                    <%= link_to('My Profile', profile_path(current_user.id)) %>  
		                  </span>
		                  <span class="menu-sub" style="background-color: <%= (params[:controller] == 'users' ) ? 'cyan' : '' %>">
		                    <%= link_to "Account","/invitation" %>
		                  </span>
		                    <%#= link_to 'My Gatherings', "/items/gatherings"%>
		                    <%#= link_to "Send Invitations","/invitation" %>
		                    <%#= link_to "Email Settings","/email_settings/index" %>
		                    <%#= link_to "Delete My Account","/users/delete_account", :confirm => "Are you sure you want to delete your account permanently?" %>
	                  <% end %> <!-- End Test C -->
                </div>
              <% end %> <!-- End Test B -->          
      
      <div class="contentholder">    
        <% if notice %>
          <div class="notice"><p style="background-color:lightgreen;"><%= notice %></p></div>
        <% end %>
        <% if alert %>
          <div class="notice"><p style="background-color:red;"><%= alert %></p></div>
        <% end %>
        <% if flash[:error] %>
          <p class="notice" style="padding: 5px;width :95%;background-color:red;"><%= flash[:error] %></p>
        <% end %>
        <%= yield %>
        <div class="clear"></div>
      </div>
      <div class="fltR footer mt30 mr100">
        <a href="/home/feedback"><%= t(:popup_12) %></a>
        <a href="/home/terms"><%= t(:terms) %></a>
        <a href="/home/contact"><%= t(:contact) %></a>        
      </div>
		<div>
    		<h2>Debug</h2>
    		<div><span>Controller : </span><span><%= params[:controller] %></span></div>
    		<div><span>Action : </span><span><%= params[:action] %></span></div>
    	</div>
    </div>
    
    <%= render :partial => "/layouts/social_medias" %>
    <script type="text/javascript">    
		$(document).ready(function() {
				$("input[hint]").hint();
				$("textarea[hint]").hint();
				$('#loginpannel').toggle();
			});
	
		$(window).load(function() {
			$("input[hint]").hint();
			$("textarea[hint]").hint();
			$('#loginpannel').toggle();
			$('.notice').delay(3500).fadeTo("slow", 0.00, function(){
				$(this).slideUp("slow", function() {
					$(this).remove();
				});
			});
		});

	  function addParamToUrl(param, value)  {
		  //check if param exists
		  var result = new RegExp(param + "=([^&]*)", "i").exec(window.location.search);
		  result = result && result[1] || "";
		
		  //added seperately to append ? before params
		  var loc = window.location;
		  var url = loc.protocol + '//' + loc.host + loc.pathname + loc.search;
		
		  //param doesn't exist in url, add it
		  if (result == '') {
			  //doesn't have any params
			  if (loc.search == '') {
			  		url += "?" + param + '=' + value;
			  } else {
			  		url += "&" + param + '=' + value;
			  }
			} else {
			  value_to = param == 'curr' ? value == 'USD' ? 'EUR' : 'USD' : value == 'fr' ? 'en' : 'fr';
			  value_from = param == 'curr' ? value == 'USD' ? 'USD' : 'EUR' : value == 'fr' ? 'fr' : 'en';
			  url = param == 'curr' ? url.replace("curr="+value_to,"curr="+value_from) : url.replace("locale="+value_to,"locale="+value_from);
		  }
		
		  //return the finished url
		  window.location = url;
	  }
	
	  function search_menu(){
	  		$('#search_options').toggle();
	  }
	  
	  function login_menu(){
	  		$('#loginpannel').toggle();
	  }
	
	  $(document).click(function(event) {  
	  		if($(event.target).hasClass("searchMenu") == true){      
	  			$('#search_options').show();
	  		} else {
	  			if($('#search_options').is(":hidden") == false){
	  				$('#search_options').hide();
	  			}
	  		}
	  		
	  });
</script>
  </body>
</html>